<!DOCTYPE html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
  -->

  
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>GalagoMusic</title>
    
    <!-- jQuery -->
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

    <script type="text/javascript">
    $(document).bind("mobileinit", function(){
    $.mobile.allowCrossDomainPages = true;
    $.mobile.support.cors = true;
    //$.mobile.defaultPageTransition='none';
    //$.mobile.defaultDialogTransition='none';
    $.mobile.buttonMarkup.hoverDelay=0;
    //$.mobile.ignoreContentEnabled="true";
    });
    </script>

    <script type="text/javascript" src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>

    <!-- Custom -->
    <script type="text/javascript" src="js/magicline.js"></script>
    <script type="text/javascript" src="js/cssToggle.js"></script>
    
    <!-- PhoneGap -->
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    
    <script type="text/javascript">
        
    document.addEventListener("deviceready",onDeviceReady,false);
    var dataJSON;
    var dataJSONPaying;
    var db = null;
    
    function onDeviceReady() 
    {    
        db = window.openDatabase("GalagoFavs", "1.0", "GalagoFavs", 200000);
        db.transaction(createDB,successDB,errorDB);
        getJSONData();
    }
    
    function createDB(tx)
    {
        tx.executeSql("CREATE TABLE IF NOT EXISTS GalagoFavs (id unique)");
    }
    
    function successDB()
    {
        
    }
    
    function errorDB()
    {
        
    }
    
    function queryDB(tx,index)
    {
        tx.executeSql("SELECT id FROM GalagoFavs WHERE id='"+index+"'",
                        populateFavorite(index));
    }
    
    function getJSONData()
    {
        //
        // Ajax request
        //
        
        $url = "http://www.galagomusic.com/JSON/json_get_data.php?user=GalagoTeam&password=GalaTeam";
        $.getJSON($url, function(data) 
                           {
                           console.log("Successfully got data from GalagoMusic");
                           dataJSON = data;
                           populatePages();
                           displayPages();
                           });
        
        $url_paying = "http://www.galagomusic.com/JSON/json_get_paying_data.php?user=GalagoTeam&password=GalaTeam";
        $.getJSON($url_paying, function(data) 
                           {
                           console.log("Successfully got paying data from GalagoMusic");
                           dataJSONPaying = data;
                           populateDonate();
                           });
    }
    
    function populatePages() {
        for (var i = 0; i < dataJSON.length; ++i)
        {
            populateRecent(i);
            populateDifficulty(i);
            db.transaction(function(tx){queryDB(tx,i);});
        }
    }
    
    function populateRecent(index)
    {
        if (index < dataJSON.length)
        {
        console.log("Populate recent");
        
        var newItem = $("<table class='itemCours'>\
                                <tr class='itemCoursPreview'>\
                                    <td class='itemCoursTitleArtist'>\
                                        <span class='itemCoursTitle'>"+dataJSON[index].Title+"</span><br/>\
                                        <span class='itemCoursArtist'>"+dataJSON[index].Artist+"</span>\
                                    </td>\
                                    <td class='itemCoursDifficulty'>DIFFICULTY<br/>"+dataJSON[index].Difficulty+" / 10\
                                    </td>\
                                </tr>\
                                <tr class='coursProperties itemCoursWhiteLine'>\
                                    <td></td><td></td>\
                                </tr>\
                                <tr class='coursProperties'>\
                                    <td class='itemCoursDuration'><img src='img/icone-timer.png'></img><span> "+dataJSON[index].Duration+"</span></td>\
                                    <td class='itemCoursFavorite'><span>Favorite</span></td>\
                                </tr>\
                                <tr class='coursProperties'>\
                                    <td class='itemCoursGuitar'><span>"+dataJSON[index].Instrument+"</span></td>\
                                </tr>"+ (dataJSON[index].Tablature === "" ? "" : 
                                "<tr class='coursProperties'>\
                                    <td colspan='2' class='itemCoursTab'><a>Download Tablature</a></td>\
                                </tr>\
                                <tr class='coursProperties itemCoursSpacer'>\
                                    <td></td><td></td>\
                                </tr>") +
                                "<tr class='coursProperties'>\
                                    <td colspan='2' class='itemCoursWatch'><a>Watch Video</a></td>\
                                </tr>\
                                <tr class='coursProperties itemCoursSpacer'>\
                                    <td></td><td></td>\
                                </tr>\
                            </table>");
        
        $("#recentPage .pageContent").append(newItem);
        newItem.find(".itemCoursTitleArtist").on('click', function(){
            $(newItem).find(".coursProperties").fadeToggle();
         });
        
        newItem.find(".itemCoursTab").on('click',function(){
            navigator.app.loadUrl(dataJSON[index].Tablature,{openExternal:true});
        });
        
        newItem.find(".itemCoursWatch").on('click',function(){ 
           navigator.app.loadUrl("http:"+dataJSON[index].YouTube,{openExternal:true});
        });
        
        
        }
        
    }
    
    function populateDifficulty(index)
    {
        if (index < dataJSON.length)
        {
            console.log("Populate Difficulty");
            $("#difficultyPage .pageContent #diff"+dataJSON[index].Difficulty).append(
                            "<div class='itemCours'>\
                                <div class='TitleArtist'>\
                                    <span class='Title'>"
                                    +dataJSON[index].Title+"</span><br/>\
                                    <span class='Artist'>"
                                    +dataJSON[index].Artist+"</span>\
                                </div>\
                                <div class='Difficulty'>DIFFICULTY<br />"
                                    +dataJSON[index].Difficulty+" / 10\
                                </div>\
                            </div>").children(".itemCours").hide();
        }
    }
    
    function populateFavorite(index)
    {
        console.log("Populate Favorite");
    }
    
    function populateDonate()
    {           
        var supportTextEnglish = $("<i style='margin-left:1%;'>You have two options to support GalagoMusic:<br>\
                             <ol>\
                                 <li>Buy a Galago course</li>\
                                 <li>Participate to Galagothon</li>\
                             </ol></i>");
        var supportTextFrench = $("<i style='margin-left:1%;'>Vous pouvez soutenir GalagoMusic de deux facons:<br>\
                             <ol>\
                                 <li>Acheter un cours GalagoMusic</li>\
                                 <li>Participer au Galagothon</li>\
                             </ol></i>");

        var payingCourseTitle = $("<div id='payingCourses'><span class='donateTitle'>GalagoCourses / GalagoCours</span></div>");

        var paypalTitle = $("<div id='paypal'><span class='donateTitle'>Galagothon</span></div>");

        $("#donatePage .pageContent").append(supportTextEnglish);
        $("#donatePage .pageContent").append(supportTextFrench);
        $("#donatePage .pageContent").append(payingCourseTitle);

        for (var i = 0; i < dataJSONPaying.length; ++i)
        {
         insertNewPayingCourse(i);
        }

        $("#donatePage .pageContent").append(paypalTitle);
        
        var galagothon = $('<div id="galagothon" class="one-half-last" style="margin-left:1%;">\
		<p>Vous appréciez les cours, la méthode et la bonne humeur ? Alors n\'hésitez pas à offrir un coup de pouce à Galagomusic en faisant un don, ceci permettra de perpétuer la qualité du travail proposé. En vous remerciant d\'avance !</br>\
Musicalement, <br /><i>Eric Legaud</i>.</p>\
		<div style="float:left; width:100%; height: 151px; background-color:#b51f29; overflow:hidden; margin-top:15px;">\
			<p style="float: left; font-size: 17px; color: #fff; width: 100%; margin-top: 10px; text-align: center;">Participez à l\'aventure,</br><b>faites un don</b></br>en cliquant ci-dessous.</p>\
			<form style="width:200px; margin-left:auto;margin-right:auto;"action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">\
				<input type="hidden" name="cmd" value="_s-xclick">\
				<input type="hidden" name="hosted_button_id" value="XVDN2ARWSWEPA">\
				<input type="image" src="https://www.paypalobjects.com/fr_FR/FR/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - Solution de paiement en ligne la plus sécurisée !">\
			</form>\
		</div>\
	</div>');
        
        $("#donatePage .pageContent").append(galagothon);
    }
    
    function insertNewPayingCourse(index)
    {
        if (index < dataJSONPaying.length)
        {
        var newItem = $("<table class='itemCours'>\
             <tr class='itemCoursPreview'>\
                 <td class='itemCoursTitleArtist'>\
                     <span class='itemCoursTitle'>"+dataJSONPaying[index].Title+"</span>\
                 </td>\
             </tr>\
             <tr class='coursProperties itemCoursWhiteLine'>\
                 <td></td><td></td>\
             </tr>\
             <tr class='coursProperties'>\
                 <td class='itemCoursDescription'>"+dataJSONPaying[index].Description+"</td>\
             </tr>\
             <tr class='coursProperties'>\
                 <td colspan='2' class='itemCoursWatch'><a>Watch Trailer</a></td>\
             </tr>\
             <tr class='coursProperties itemCoursSpacer'>\
                 <td></td><td></td>\
             </tr>\
             <tr class='coursProperties'>\
                 <td colspan='2' class='itemCoursBuy'><a>Buy</a></td>\
             </tr>\
             <tr class='coursProperties itemCoursSpacer'>\
                 <td></td><td></td>\
             </tr>\
         </table>");

         $("#donatePage .pageContent #payingCourses").append(newItem);
         newItem.find(".itemCoursTitleArtist").on('click', function(){
             $(newItem).find(".coursProperties").fadeToggle();
          });

         newItem.find(".itemCoursBuy").on('click',function(){
             navigator.app.loadUrl(dataJSONPaying[index].Link,{openExternal:true});
         });

         newItem.find(".itemCoursWatch").on('click',function(){ 
            navigator.app.loadUrl("http:"+dataJSONPaying[index].YouTube,{openExternal:true});
         });
        }
    }
    
    // Display main page after loading data
    //
    function displayPages() 
    {
        console.log("Show mainApp");
        //$("#recentPage .pageContent .itemCours:lt(5)").css("display","table");
        $("body #splashScreen").fadeOut(10, function() {
      	$("body #mainApp").fadeIn(10);
      	});

    }  
    </script>

  
  <body>
    <!-- Splash Screen -->  
    <div id="splashScreen" data-role="none">
      <h1 id="title">GalagoMusic</h1><br/>
    </div>

    <!-- Main Application -->
    <div id="mainApp">
      <div id="pages">
          
        <!-- Recent Page -->  
        <div id="recentPage" class="current" data-role="page">
            
            <div data-role="header" data-position="fixed" data-id="header" data-theme="c">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#recentPage" class="ui-btn-active ui-state-persist">Recent</a></li>
                        <li><a href="#difficultyPage">Difficulty</a></li>
                        <li><a href="#favoritePage">Favorite</a></li>
                        <li><a href="#donatePage">Donate</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="pageContent" data-role="content">
            </div>
            
        </div>
        
        <!-- Difficulty Page -->
        <div id="difficultyPage" data-role="page">
            
            <div data-role="header" data-position="fixed" data-id="header" data-theme="c">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#recentPage">Recent</a></li>
                        <li><a href="#difficultyPage" class="ui-btn-active ui-state-persist">Difficulty</a></li>
                        <li><a href="#favoritePage">Favorite</a></li>
                        <li><a href="#donatePage">Donate</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="pageContent" data-role="content">
                <div id="diff1"><span class="difficultyTab">Difficulty 1 / 10</span></div>
                <div id="diff2"><span class="difficultyTab">Difficulty 2 / 10</span></div>
                <div id="diff3"><span class="difficultyTab">Difficulty 3 / 10</span></div>
                <div id="diff4"><span class="difficultyTab">Difficulty 4 / 10</span></div>
                <div id="diff5"><span class="difficultyTab">Difficulty 5 / 10</span></div>
                <div id="diff6"><span class="difficultyTab">Difficulty 6 / 10</span></div>
                <div id="diff7"><span class="difficultyTab">Difficulty 7 / 10</span></div>
                <div id="diff8"><span class="difficultyTab">Difficulty 8 / 10</span></div>
                <div id="diff9"><span class="difficultyTab">Difficulty 9 / 10</span></div>
                <div id="diff10"><span class="difficultyTab">Difficulty 10 / 10</span></div>
            </div>
            
        </div>
        
        <!-- Favorite Page -->
        <div id="favoritePage" data-role="page">
            
            <div data-role="header" data-position="fixed" data-id="header" data-theme="c">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#recentPage">Recent</a></li>
                        <li><a href="#difficultyPage">Difficulty</a></li>
                        <li><a href="#favoritePage" class="ui-btn-active ui-state-persist">Favorite</a></li>
                        <li><a href="#donatePage">Donate</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="pageContent" data-role="content">
            </div>
            
        </div>
        
        <!-- Donate Page -->
        <div id="donatePage" data-role="page">
            
            <div data-role="header" data-position="fixed" data-id="header" data-theme="c">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#recentPage">Recent</a></li>
                        <li><a href="#difficultyPage">Difficulty</a></li>
                        <li><a href="#favoritePage">Favorite</a></li>
                        <li><a href="#donatePage" class="ui-btn-active ui-state-persist">Donate</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="pageContent" data-role="content">
            </div>
            
        </div>
      </div>
    </div>

    <script type="text/javascript">
      app.initialize();
    </script>
    
    <script type="text/javascript">
        $(".difficultyTab").on("touchstart",function(event){
           var parent = $(event.target).closest("div");
           $(parent).children(".itemCours").fadeToggle();
        });
    </script>
    
  </body>

